<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Finance Tracker Frontend</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; }
    h2 { margin-top: 30px; }
    input, textarea, select { width: 100%; padding: 8px; margin: 5px 0; }
    button { padding: 10px 15px; margin-top: 5px; }
    .box { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 6px; }
    .transaction { background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>Finance Tracker Frontend</h1>

  <!-- Signup -->
  <h2>Signup</h2>
  <input id="signupName" placeholder="Name">
  <input id="signupEmail" placeholder="Email">
  <select id="signupType">
    <option value="savings">Savings</option>
    <option value="current">Current</option>
  </select>
  <input id="signupPass" placeholder="Password" type="password">
  <button onclick="signup()">Signup</button>
  <p id="signupMsg"></p>

  <!-- Login -->
  <h2>Login</h2>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPass" placeholder="Password" type="password">
  <button onclick="login()">Login</button>
  <p id="loginMsg"></p>

  <!-- Add Transaction -->
  <h2>Add Transaction</h2>
  <input id="txnAmount" placeholder="Amount" type="number">
  <select id="txnType">
    <option value="credit">Credit</option>
    <option value="debit">Debit</option>
  </select>
  <input id="txnDesc" placeholder="Description">
  <button onclick="addTransaction()">Add Transaction</button>
  <p id="txnMsg"></p>

  <!-- All Transactions -->
  <h2>Transactions</h2>
  <button onclick="getTransactions()">Load Transactions</button>
  <div id="transactions"></div>

  <script>
    const API = "https://finance-tracker-kj5z.onrender.com/api";
    let token = "";

    // Signup
    async function signup() {
      const res = await fetch(`${API}/auth/signup`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: document.getElementById("signupName").value,
          email: document.getElementById("signupEmail").value,
          accountType: document.getElementById("signupType").value,
          password: document.getElementById("signupPass").value
        })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        document.getElementById("signupMsg").innerText = "‚úÖ Signup successful!";
      } else {
        document.getElementById("signupMsg").innerText = data.message || "‚ùå Signup failed.";
      }
    }

    // Login
    async function login() {
      const res = await fetch(`${API}/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: document.getElementById("loginEmail").value,
          password: document.getElementById("loginPass").value
        })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        document.getElementById("loginMsg").innerText = "‚úÖ Login successful!";
      } else {
        document.getElementById("loginMsg").innerText = data.message || "‚ùå Login failed.";
      }
    }

    // Add Transaction
    async function addTransaction() {
      if (!token) return alert("Please login first!");
      const res = await fetch(`${API}/transactions`, {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({
          amount: document.getElementById("txnAmount").value,
          type: document.getElementById("txnType").value,
          description: document.getElementById("txnDesc").value
        })
      });
      const data = await res.json();
      if (data._id) {
        document.getElementById("txnMsg").innerText = "‚úÖ Transaction added successfully!";
      } else {
        document.getElementById("txnMsg").innerText = data.message || "‚ùå Failed to add transaction.";
      }
    }

    // Get Transactions
    async function getTransactions() {
      if (!token) return alert("Please login first!");

      try {
        const res = await fetch(`${API}/transactions`, {
          headers: { "Authorization": `Bearer ${token}` }
        });

        const data = await res.json();
        console.log("Transactions response:", data); // üëà debug log

        // Handle both formats: [ ... ] or { transactions: [...] }
        const txns = Array.isArray(data) ? data : data.transactions || [];

        const container = document.getElementById("transactions");
        container.innerHTML = "";

        if (!Array.isArray(txns) || txns.length === 0) {
          container.innerHTML = "<p>No transactions found.</p>";
          return;
        }

        txns.forEach(t => {
          const div = document.createElement("div");
          div.className = "box transaction";
          div.innerHTML = `
            <p><strong>${t.type.toUpperCase()}</strong>: $${t.amount}</p>
            <p>${t.description}</p>
            <small>ID: ${t._id}</small>
          `;
          container.appendChild(div);
        });
      } catch (err) {
        console.error("Error loading transactions:", err);
        document.getElementById("transactions").innerHTML =
          "<p>‚ùå Failed to load transactions.</p>";
      }
    }
  </script>
</body>
</html>
